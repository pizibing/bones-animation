## 2009.7.20总结 ##

## 完成的工作 ##
上午弄清楚了FCollada动画数据的获取途径.<p>
下午去公司开会,总结一周工作,制定本周工作计划.<p>
<h2>遇到的问题</h2>
FCollada动画数据的获取途径: <p>
1.通过animationLib获取animation,再通过它的channel获取Curve从而读取到animationKey <p>
2.通过sceneNodeLib获取sceneNode,再通过它的transform 获取animated,再查找相应的curve,获取animationKey <p>
第一种方式似乎已经被新版本的fCollada（3.05b）放弃了，虽然依旧可以获取animationLib，但注释中提到不推荐使用此lib，而是用animated。animationKey的数据可以获得，却无法获得对应的sceneNode变换了。 <p>
第二种方式确实可以获取对应的transform（比如，类型是Matrix，可以知道curve对应matrix的哪个值）。总觉得用起来很麻烦。<br>
<br>
<h2>下一天的工作计划</h2>
配合徐凌靖完成动画数据载入和显示<p>
考虑从高度图生成Terrain的实现与显示<p>

###################################################################################<br>
<br>
<h2>2009.7.21总结</h2>

<h2>完成的工作</h2>
重构chAnimation在chAniamtionManager中的存储方式,允许加载不确定个数的动画.<br>
<br>
<h2>下一天的工作计划</h2>
实现骨骼的线段显示<br>
<br>
###################################################################################<br>
<br>
<h2>2009.7.22总结</h2>

<h2>完成的工作</h2>
完成骨骼的线段显示的数据计算,但尚未添加界面显示支持.<p>
解决一些有关动画数据的一些小错误.<br>
<h2>遇到的问题</h2>
动态模型未显示出来,尚不清楚是什么问题.<br>
<h2>下一天的工作计划</h2>
继续解决动画数据显示问题.<br>
<br>
###################################################################################<br>
<br>
<h2>2009.7.23总结</h2>

<h2>完成的工作</h2>
解决一些有关动画数据的一些小错误.<br>
<h2>已解决的问题</h2>
1. 四元数一个构造函数中缺少对变量成员z的赋值 <p>
2. Matrix默认构造函数设置单位矩阵位置设错. <p>
3. 四元数默认构造改为构造不旋转的单位四元数（0,0,0,1）<p>
4. Vector3D 默认构造函数应该为（0,0,0）而不是（0,0,1） <p>
5. FColladaLoader 中 FCDMatrix44（2维4x4数组）转到Matrix（1维16数组）行和列颠倒了 <p>
6. 计算世界坐标系的变换中的一个严重的错误(导致无法遍历计算字节点)和一个疏忽产生的错误（应获得<p>父节点的绝对变换而不是相对变换）<p>
7. 发现动画数据实际上是重置所有的相对变换，而不是在原变换基础上继续变换。<p>
<h2>尚未解决的问题</h2>
1. libcontroller中Joint有23个node,但未包括rootBone,也就是rootbone不会直接影响skin,但由动画<p>部分,动画载入部分未考虑这个问题.<p>
2. 不知道为什么人物一直在转，尽管一直在播放第一帧<p>
3. 键盘控制导致人物骨骼分散，而且很快全部消失。<p>

###################################################################################<br>
<br>
<h2>2009.7.24总结</h2>

<h2>完成的工作</h2>
改正矩阵读取与转换问题<br>
<h2>遇到的问题</h2>
collada dae文件matrix是行优先，而fcollada的fMMatrix44是列优先如m21是指第3列第2行；<p>
我们的matrix是按照openGL的matrix设计的，也是列优先。<p>
按照这种设计，发现昨天关于fcolladaLoader的改动是错的，原来的是直接获取fmmatrix44再转换和<p>直接读取collada matrix再转换，两种转换不一致，现在全部改成使用fmmatrix读取collada matrix，<p>再把fmmatrix44转换到我们的matrix。<p>

<h2>下一天的工作计划</h2>
检查四元数运算，特别是四元数和矩阵转换，四元数插值。<br>
<br>
<br>
###################################################################################<br>
<br>
<h2>2009.7.25总结</h2>
<h2>完成的工作</h2>
重构quaternion<br>
参考Cal3D重构四元数插值算法<br>
<br>
<h2>遇到的问题</h2>
1. matrix和quaternion各自乘法次序问题<p>
<blockquote>仔细察看实现matrix做的是用另一个matrix右乘当前矩阵，而quaternion是用另一个四元数左乘当前<p>四元数。因为OpenGL矩阵乘法是右乘的，所以我们需要把四元数乘法实现次序改成右乘的。<p>
同时，原来skeleton和skeletonInstance计算世界坐标系的变换时用的是左乘，也要改成右乘以统一<p>次序。<p>
2. matrix对点和向量作变换<p>
点用矩阵变换需要旋转和平移（OpenGL中点作为4维列向量参与矩阵运算），而向量只需要旋转不需要平移。<p>
因此，矩阵变换时，对于点(x,y,z)应对应（x,y,z,1）T,而向量则应该是(x,y,z,0)T <p>
之前，我们没注意到这些细节，现在已改正。</blockquote>

###################################################################################<br>
<br>
<h2>2009.7.26总结</h2>
<h2>完成的工作</h2>
使用另一种fps计算方法,直接数1秒的帧数，而不是一帧时间的倒数，以稳定数值<p>
正确载入bindPoseMatrix<p>